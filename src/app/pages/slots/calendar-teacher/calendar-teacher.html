<ejs-schedule
    #scheduleRef
    width="100%"
    height="700px"
    [eventSettings]="eventSettings()"
    [startHour]="startHour"
    [endHour]="endHour"
    [timeScale]="timeScale"
    [allowDragAndDrop]="true"
    [views]="['Day', 'Week', 'Month']"
    [allowResizing]="true"
    currentView="Week"
    (dragStart)="onDragStart($event)"
    (dragStop)="onDragStop($event)"
    (resizeStart)="onResizeStart($event)"
    (resizeStop)="onResizeStop($event)"
    (cellClick)="onCellClick($event)"
    (popupOpen)="onPopupOpen($event)"
    (eventClick)="clickEvent($event)"
    (eventRendered)="applyBgColor($event)"
    (dataBound)="onDataBound($event)"
    (navigating)="onNavigating($event)"
    (actionComplete)="onActionComplete($event)"
>
    <ng-template #eventSettingsTemplate let-data>
        @let slot = data.ExtendedProps?.['slot'];
        <header class="w-full flex justify-end px-2 py-1">
            <p-button variant="text" severity="danger" pTooltip="Supprimer" (onClick)="openConfirmDeleteModal($event, slot)" tooltipPosition="top">
                <ng-template #icon>
                    <i class="pi pi-times" size="small"></i>
                </ng-template>

                <ng-template #buttonContent (click)="clickEvent({event: data})"></ng-template>
            </p-button>
        </header>
        <div class="template-wrap" class="h-full w-full">
            <div class="time">Creneau : {{ slot?.dateFrom | date:'shortTime' }} - {{ slot?.dateTo | date:'shortTime' }}</div>
        </div>
    </ng-template>
</ejs-schedule>

@if(visibleCreateSlotModal()) {
<bp-modal-create-slot [(visible)]="visibleCreateSlotModal" [event]="selectedDate" (submitClicked)="handleEvent($event)" (cancelClicked)="cancel()"></bp-modal-create-slot>
} @if(visibleConfirmDeleteModal()) {
<bp-confirm-modal
    [(visible)]="visibleConfirmDeleteModal"
    title="Confirmer la suppression"
    message="Êtes-vous sûr de vouloir supprimer ce créneau ?"
    confirmButtonLabel="Supprimer"
    cancelButtonLabel="Annuler"
    severity="danger"
    (onConfirm)="removeSlot()"
    (cancelClicked)="visibleConfirmDeleteModal.set(false)"
></bp-confirm-modal>
}
